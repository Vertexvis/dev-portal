(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{125:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,m=u["".concat(o,".").concat(d)]||u[d]||b[d]||i;return n?r.a.createElement(m,s(s({ref:t},c),{},{components:n})):r.a.createElement(m,s({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},160:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(0),r=n.n(a);function i(){return r.a.createElement(r.a.Fragment,null,"Your Vertex client secret is sensitive and must be kept secure at all times. You should ",r.a.createElement("strong",null,"never")," include it in client-side web applications.")}},239:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/vertex-platform-architecture@4x-4737da211532f00c3c3ac2b7bc9ef750.png"},89:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var a=n(3),r=n(7),i=(n(0),n(125)),o=n(160),s={id:"build-your-first-app",title:"Build your first application",description:"Use the Vertex platform's NextJS starter to build your first application."},l={unversionedId:"guides/build-your-first-app",id:"guides/build-your-first-app",isDocsHomePage:!1,title:"Build your first application",description:"Use the Vertex platform's NextJS starter to build your first application.",source:"@site/docs/guides/build-your-first-app.mdx",sourceDirName:"guides",slug:"/guides/build-your-first-app",permalink:"/docs/guides/build-your-first-app",editUrl:"https://github.com/Vertexvis/dev-portal/tree/main/docs/guides/build-your-first-app.mdx",version:"current",frontMatter:{id:"build-your-first-app",title:"Build your first application",description:"Use the Vertex platform's NextJS starter to build your first application."},sidebar:"guidesSidebar",previous:{title:"Import data with CLI",permalink:"/docs/guides/import-data"},next:{title:"Postman quick start",permalink:"/docs/guides/postman-quick-start"}},c=[{value:"Before we start",id:"before-we-start",children:[]},{value:"Creating your application",id:"creating-your-application",children:[]},{value:"Opening your scene",id:"opening-your-scene",children:[]},{value:"Understanding the code",id:"understanding-the-code",children:[]},{value:"Calling the Vertex API",id:"calling-the-vertex-api",children:[]},{value:"Deploying your application",id:"deploying-your-application",children:[]},{value:"Wrapping up",id:"wrapping-up",children:[]}],p={toc:c};function u(e){var t=e.components,s=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,s,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"You have now ",Object(i.b)("a",{parentName:"p",href:"/docs/guides/render-your-first-scene"},"rendered your first scene")," and ",Object(i.b)("a",{parentName:"p",href:"/docs/guides/import-data"},"imported your data"),". Next, let's build an application you can deploy publicly!"),Object(i.b)("p",null,"We'll be using the Vertex Web UI Components, which are standards-based ",Object(i.b)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/Web_Components"},"web components"),". You could create your app using plain JavaScript, but we'll use ",Object(i.b)("a",{parentName:"p",href:"https://nextjs.org/"},"NextJS"),", a ",Object(i.b)("a",{parentName:"p",href:"https://reactjs.org/"},"React"),"-based framework with a great developer experience."),Object(i.b)("p",null,"To get an idea of what you'll be building, check out this ",Object(i.b)("a",{parentName:"p",href:"https://nextjs-starter.vertexvis.io/?clientId=08F675C4AACE8C0214362DB5EFD4FACAFA556D463ECA00877CB225157EF58BFA&streamKey=U9cSWVb7fvS9k-NQcT28uZG6wtm6xmiG0ctU"},"example application")," we created."),Object(i.b)("h2",{id:"before-we-start"},"Before we start"),Object(i.b)("p",null,"The following diagram gives an overview of how your applications interact with the Vertex Cloud."),Object(i.b)("p",null,Object(i.b)("img",{alt:"Vertex Platform Architecture",src:n(239).default,title:"Vertex Platform Architecture"})),Object(i.b)("p",null,"In the ",Object(i.b)("a",{parentName:"p",href:"/docs/guides/render-your-first-scene"},"Render your first scene")," guide, we focused on the ",Object(i.b)("strong",{parentName:"p"},"Your Application")," section, communicating with the Vertex WebSocket using Vertex's test stream key. In the ",Object(i.b)("a",{parentName:"p",href:"/docs/guides/import-data"},"Import data")," guide, instead of having you create an API in the ",Object(i.b)("strong",{parentName:"p"},"Your Cloud")," section, we used the Vertex CLI, which uses the Vertex API Client to communicate with the Vertex REST API using OAuth tokens."),Object(i.b)("p",null,"In this guide, we'll create a deployable application with an API. With this application, you can securely talk to both the Vertex WebSocket and Vertex REST API. Using these pieces, the full power of the Vertex platform is in your hands."),Object(i.b)("h2",{id:"creating-your-application"},"Creating your application"),Object(i.b)("p",null,"Use our ",Object(i.b)("a",{parentName:"p",href:"https://github.com/Vertexvis/vertex-nextjs-starter"},"NextJS Starter template")," on GitHub. Press the ",Object(i.b)("strong",{parentName:"p"},"Use this template")," button to create a new repository as your starting point. If you'd rather use something other than GitHub, simply clone the repository."),Object(i.b)("p",null,"Once your repository exists, start the application with ",Object(i.b)("a",{parentName:"p",href:"https://classic.yarnpkg.com/en/docs/install/"},"Yarn"),"."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"# Install dependencies\nyarn install\n\n# Start development server\nyarn dev\n")),Object(i.b)("p",null,"Browse to ",Object(i.b)("a",{parentName:"p",href:"http://localhost:3000"},"http://localhost:3000")," to see your application displaying the Vertex test scene!"),Object(i.b)("h2",{id:"opening-your-scene"},"Opening your scene"),Object(i.b)("p",null,"You can open different scenes in your application using the ",Object(i.b)("strong",{parentName:"p"},"Open Scene")," button. Each scene requires both your Vertex client ID and a stream key."),Object(i.b)("p",null,"To create a stream key, you'll need your scene ID from the ",Object(i.b)("a",{parentName:"p",href:"/docs/guides/import-data"},"Import data")," guide. If you have it handy, great! If not, you can list your scenes with the CLI and copy the ID."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"vertex scenes:list --extended\n")),Object(i.b)("p",null,"Stream keys grant Vertex's Viewer UI component access to your scene. The default stream key expiration is 10 minutes (600 seconds). You can increase this to a maximum of 24 hours (86000 seconds) using the ",Object(i.b)("inlineCode",{parentName:"p"},"--expiry")," flag."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"vertex stream-keys:create --sceneId [YOUR_SCENE_ID] --expiry 86000\n")),Object(i.b)("p",null,"Now, in your application, click ",Object(i.b)("strong",{parentName:"p"},"Open Scene"),", enter your client ID and stream key, and click ",Object(i.b)("strong",{parentName:"p"},"Open Scene"),". You'll now see your scene instead of the test scene."),Object(i.b)("h2",{id:"understanding-the-code"},"Understanding the code"),Object(i.b)("p",null,"Start by opening ",Object(i.b)("a",{parentName:"p",href:"https://github.com/Vertexvis/vertex-nextjs-starter/blob/main/src/pages/index.tsx"},Object(i.b)("inlineCode",{parentName:"a"},"src/pages/index.tsx")),". We'll walk through the ",Object(i.b)("inlineCode",{parentName:"p"},"Home")," function in pieces."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-tsx"},"// Prefer credentials in URL to enable easy scene sharing.\n// If they don't exist, check local storage. If empty, use defaults.\nconst router = useRouter();\nconst { clientId: queryId, streamKey: queryKey } = router.query;\nconst stored = getStoredCreds();\nconst [credentials, setCredentials] = React.useState<StreamCredentials>({\n  clientId: queryId?.toString() || stored.clientId || DefaultClientId,\n  streamKey: queryKey?.toString() || stored.streamKey || DefaultStreamKey,\n});\n\n// On credentials changes, update URL and store in local storage.\nReact.useEffect(() => {\n  router.push(encodeCreds(credentials));\n  setStoredCreds(credentials);\n}, [credentials]);\n\n// Open dialog if 'o' key pressed\nconst keys = useKeyListener();\nReact.useEffect(() => {\n  if (!dialogOpen && keys.o) setDialogOpen(true);\n}, [keys]);\n\nconst viewer = useViewer();\nconst [dialogOpen, setDialogOpen] = React.useState(false);\nconst [properties, setProperties] = React.useState<Properties>({});\nconst ready = credentials.clientId && credentials.streamKey && viewer.isReady;\n")),Object(i.b)("p",null,"At the top, we configure variables we'll need later. We also use ",Object(i.b)("a",{parentName:"p",href:"https://reactjs.org/docs/hooks-effect.html"},"React effect hooks")," to update the URL and local storage on credential changes and listen for 'o' key presses to open the ",Object(i.b)("strong",{parentName:"p"},"Open Scene")," dialog."),Object(i.b)("p",null,"Now, the fun stuff. We return a ",Object(i.b)("a",{parentName:"p",href:"https://reactjs.org/docs/jsx-in-depth.html"},Object(i.b)("inlineCode",{parentName:"a"},"JSX"))," element representing your application."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-tsx"},"return (\n  <Layout\n    header={<OpenButton onClick={() => setDialogOpen(true)} />}\n    main={\n      ready && (\n        <Viewer\n          configEnv={Env}\n          credentials={credentials}\n          onSelect={async (hit) => {\n            setProperties(toProperties({ hit }));\n            await selectByHit({ hit, viewer: viewer.ref.current });\n          }}\n          viewer={viewer.ref}\n        />\n      )\n    }\n    rightDrawer={<RightDrawer properties={properties} />}\n  >\n    {dialogOpen && (\n      <OpenDialog\n        credentials={credentials}\n        onClose={() => setDialogOpen(false)}\n        onConfirm={(cs) => {\n          setCredentials(cs);\n          setDialogOpen(false);\n        }}\n        open={dialogOpen}\n      />\n    )}\n  </Layout>\n);\n")),Object(i.b)("p",null,"Let's break this down to see exactly what's happening:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"We return the application's components wrapped in a ",Object(i.b)("inlineCode",{parentName:"li"},"Layout"),"."),Object(i.b)("li",{parentName:"ul"},"The header includes the ",Object(i.b)("strong",{parentName:"li"},"Open Scene")," button."),Object(i.b)("li",{parentName:"ul"},"Next is the main application content:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"If ",Object(i.b)("inlineCode",{parentName:"li"},"ready"),", we display the ",Object(i.b)("inlineCode",{parentName:"li"},"Viewer")," component."),Object(i.b)("li",{parentName:"ul"},"With the ",Object(i.b)("inlineCode",{parentName:"li"},"onSelect")," callback, we set the properties state. Then, call a utility function similar to the ",Object(i.b)("a",{parentName:"li",href:"/docs/guides/render-your-first-scene"},"Render your first scene")," guide's function to perform item selection."))),Object(i.b)("li",{parentName:"ul"},"The right drawer receives the metadata properties for display."),Object(i.b)("li",{parentName:"ul"},"Finally, the ",Object(i.b)("strong",{parentName:"li"},"Open Scene")," dialog. It's shown if the ",Object(i.b)("inlineCode",{parentName:"li"},"dialogOpen")," React state is ",Object(i.b)("inlineCode",{parentName:"li"},"true"),". We pass two callbacks:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"onClose")," closes the dialog."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"onConfirm")," updates the credentials, then closes the dialog.")))),Object(i.b)("h2",{id:"calling-the-vertex-api"},"Calling the Vertex API"),Object(i.b)("p",null,"Browse to ",Object(i.b)("a",{parentName:"p",href:"http://localhost:3000/api/files"},"http://localhost:3000/api/files"),". You should get a ",Object(i.b)("inlineCode",{parentName:"p"},"401: Unauthorized")," error. The application doesn't know your Vertex client ID and secret, so it cannot make API calls on your behalf. Let's fix that."),Object(i.b)("p",null,"In your terminal, type ",Object(i.b)("inlineCode",{parentName:"p"},"Ctrl+C")," to stop the development server. NextJS has ",Object(i.b)("a",{parentName:"p",href:"https://nextjs.org/docs/basic-features/environment-variables"},"built-in support for environment variables"),", and the Vertex NextJS Starter comes with a ",Object(i.b)("inlineCode",{parentName:"p"},".env.local.template")," file you can rename to make it easier for you to set them."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"mv .env.local.template .env.local\n")),Object(i.b)("p",null,"Open ",Object(i.b)("inlineCode",{parentName:"p"},".env.local")," and set the ",Object(i.b)("inlineCode",{parentName:"p"},"VERTEX_CLIENT_ID")," and ",Object(i.b)("inlineCode",{parentName:"p"},"VERTEX_CLIENT_SECRET")," to your Vertex client ID and secret. You can leave ",Object(i.b)("inlineCode",{parentName:"p"},"NEXT_PUBLIC_VERTEX_ENV")," blank. Since the environment variables don't start with ",Object(i.b)("inlineCode",{parentName:"p"},"NEXT_PUBLIC_"),", they are only exposed server-side, keeping your client secret safe."),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)(o.a,{mdxType:"ProtectSecretNote"}))),Object(i.b)("p",null,"Now, start the development server again and browse to ",Object(i.b)("a",{parentName:"p",href:"http://localhost:3000/api/files"},"http://localhost:3000/api/files"),". You should see a list of files you've uploaded!"),Object(i.b)("p",null,"How does this work? Go ahead and open ",Object(i.b)("a",{parentName:"p",href:"https://github.com/Vertexvis/vertex-nextjs-starter/blob/main/src/pages/api/files.ts"},Object(i.b)("inlineCode",{parentName:"a"},"src/pages/api/files.ts")),"."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"export default async function getFiles(\n  req: NextApiRequest,\n  res: NextApiResponse<FileList | Failure>\n): Promise<void> {\n  return makeCall(res, (client) => client.files.getFiles({ pageSize: 5 }));\n}\n")),Object(i.b)("p",null,"We're using NextJS ",Object(i.b)("a",{parentName:"p",href:"https://nextjs.org/docs/api-routes/introduction"},"API Routes")," and the ",Object(i.b)("inlineCode",{parentName:"p"},"makeCall")," helper function. Open ",Object(i.b)("a",{parentName:"p",href:"https://github.com/Vertexvis/vertex-nextjs-starter/blob/main/src/lib/vertex-api.ts"},Object(i.b)("inlineCode",{parentName:"a"},"src/lib/vertex-api.ts"))," to see what that does."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"export async function makeCall<T>(\n  res: NextApiResponse<T | Failure>,\n  apiCall: (client: VertexClient) => Promise<AxiosResponse<T>>\n): Promise<void> {\n  try {\n    const c = await getClient();\n    res.status(200).json((await apiCall(c)).data);\n  } catch (error) {\n    const failure = error.vertexError?.res;\n    if (!failure) {\n      const errors = new Set<ApiError>();\n      errors.add({ status: '500', title: 'Unknown error from Vertex API.' });\n      failure.errors = errors;\n    }\n\n    res.status(parseInt(head(failure.errors)?.status ?? 500, 10)).json(failure);\n  }\n}\n\nlet Client: VertexClient | undefined;\nasync function getClient(): Promise<VertexClient> {\n  if (Client != null) return Client;\n\n  Client = await VertexClient.build({\n    client: {\n      id: process.env.VERTEX_CLIENT_ID ?? '',\n      secret: process.env.VERTEX_CLIENT_SECRET ?? '',\n    },\n  });\n\n  return Client;\n}\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"makeCall")," calls ",Object(i.b)("inlineCode",{parentName:"p"},"getClient"),", which creates a Vertex API Client if it doesn't already exist using the environment variables we provided. It then uses the client to call the Vertex API and handles possible errors."),Object(i.b)("h2",{id:"deploying-your-application"},"Deploying your application"),Object(i.b)("p",null,"Follow one of these guides to deploy your application. If you're not sure which to choose, we recommend Vercel."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://nextjs.org/docs/deployment"},"Vercel"),": From the creators of NextJS, they know best how to deploy their framework. It's as easy as linking your GitHub/GitLab/Bitbucket account, adding environment variables, and visiting your site! On each ",Object(i.b)("inlineCode",{parentName:"li"},"git push"),", Vercel automatically deploys a new version using ",Object(i.b)("a",{parentName:"li",href:"https://vercel.com/docs/serverless-functions/introduction"},"Vercel Serverless Functions")," for APIs."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://www.netlify.com/blog/2020/11/30/how-to-deploy-next.js-sites-to-netlify/"},"Netlify"),": Similar to Vercel and just as easy. They use ",Object(i.b)("a",{parentName:"li",href:"https://www.netlify.com/products/functions/"},"Netlify Functions")," for APIs."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/serverless-nextjs/serverless-next.js#readme"},"AWS CDK"),": If you already have sites deployed in AWS, this CDK construct helps deploy NextJS, using ",Object(i.b)("a",{parentName:"li",href:"https://aws.amazon.com/lambda/edge/"},"Lambda@Edge")," for APIs.")),Object(i.b)("h2",{id:"wrapping-up"},"Wrapping up"),Object(i.b)("p",null,"Congratulations! To recap the concepts learned so far:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"The NextJS framework uses React. It allows us to create client-side and server-side portions of applications, giving you the full power of the Vertex platform."),Object(i.b)("li",{parentName:"ul"},"Your application uses Vertex UI Components and makes calls to its own API. The UI Components communicate with the Vertex WebSocket using stream keys. Your API uses the Vertex API Client and OAuth tokens to communicate with the Vertex API."),Object(i.b)("li",{parentName:"ul"},"There are many deployment options to deploy and share applications built with Vertex.")))}u.isMDXComponent=!0}}]);